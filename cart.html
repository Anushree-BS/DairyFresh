<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DairyFresh • Cart</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#fbfbfb; --card:#fff; --muted:#7b7b85; --accent:#0b1320; --glass:rgba(11,19,32,0.05); --radius:12px;}
    *{box-sizing:border-box;font-family:Inter,system-ui,Arial;}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#f6f7f8);color:var(--accent);min-height:100vh;}
    header{display:flex;align-items:center;justify-content:space-between;padding:20px 40px;}
    .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--accent)}
    main{padding:20px 40px}
    .container{max-width:980px;margin:0 auto}
    table{width:100%;border-collapse:collapse;background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 12px 30px var(--glass)}
    th,td{padding:16px;text-align:left}
    th{background:#f9fafb;color:var(--muted);font-weight:700}
    tr + tr td{border-top:1px solid rgba(11,19,32,0.04)}
    .thumb{width:100px;height:70px;object-fit:cover;border-radius:8px}
    .muted{color:var(--muted)}
    .totals{display:flex;justify-content:flex-end;margin-top:18px;gap:18px;align-items:center}
    .btn{padding:12px 18px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .checkout{background:#0b7a66;color:white}
    .clear{background:transparent;border:1px solid rgba(11,19,32,0.06)}
    .qty{width:56px;padding:8px;border-radius:8px;border:1px solid rgba(11,19,32,0.06)}
    .empty{padding:40px;text-align:center;background:var(--card);border-radius:12px;box-shadow:0 12px 30px var(--glass)}
  </style>
</head>
<body>
  <header>
    <a class="brand" href="index.html" style="text-decoration:none;color:inherit">
      <svg width="44" height="44" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="#0b1320" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M10 26c0-6 5-11 11-11 3 0 6 .8 8.5 2.5C33.2 17 36 18 39 18c6 0 11 5 11 11 0 2.8-1 6-3 8-3 3-8 4-14 4H20c-6 0-10-4-10-9 0-3 0-6 3-7z"/></g></svg>
      <div style="margin-left:8px"><div style="font-weight:700">DairyFresh</div><div style="font-size:12px;color:#7b7b85">Your cart</div></div>
    </a>

    <div style="display:flex;gap:12px;align-items:center">
      <a href="products.html" class="btn clear" style="text-decoration:none">Continue shopping</a>
      <a href="payment.html" class="btn checkout" id="topCheckout">Checkout</a>
    </div>
  </header>

  <main>
    <div class="container" id="container">
      <!-- Cart contents will be injected here -->
    </div>
  </main>

<script>
/* Read cart from localStorage and render */
function loadCart(){
  const container = document.getElementById('container');
  const cart = JSON.parse(localStorage.getItem('df_cart')||'[]');
  if(!cart.length){
    container.innerHTML = `<div class="empty"><h2>Your cart is empty</h2><p class="muted">Add some fresh dairy products from the products page.</p><div style="margin-top:18px"><a href="products.html" class="btn checkout" style="text-decoration:none">Browse products</a></div></div>`;
    updateBadge();
    return;
  }

  // build table
  let html = `<table><thead><tr><th>Product</th><th style="width:120px">Price</th><th style="width:120px">Qty</th><th style="width:160px">Subtotal</th><th style="width:70px"></th></tr></thead><tbody>`;
  cart.forEach((it,idx)=>{
    html += `<tr data-idx="${idx}">
      <td style="display:flex;gap:14px;align-items:center">
        <img class="thumb" src="${it.img}" alt="${it.title}">
        <div>
          <div style="font-weight:700">${it.title}</div>
          <div class="muted">ID: ${it.id}</div>
        </div>
      </td>
      <td>₹${it.price.toFixed(0)}</td>
      <td><input class="qty" type="number" min="1" value="${it.qty||1}" data-id="${it.id}" /></td>
      <td class="sub">₹${(it.price*(it.qty||1)).toFixed(0)}</td>
      <td><button class="btn clear remove" data-id="${it.id}">Remove</button></td>
    </tr>`;
  });
  html += `</tbody></table>`;

  // totals
  const total = cart.reduce((s,i)=>s + i.price*(i.qty||1), 0);
  html += `<div class="totals"><div style="font-weight:700;font-size:18px">Total: ₹${total.toFixed(0)}</div></div>`;
  html += `<div style="display:flex;justify-content:flex-end;margin-top:18px;gap:12px"><button class="btn clear" id="clearBtn">Clear Cart</button><a href="payment.html" class="btn checkout" id="checkoutBtn">Proceed to Payment</a></div>`;

  container.innerHTML = html;

  // attach listeners
  document.querySelectorAll('.qty').forEach(inp=>{
    inp.addEventListener('change', (e)=>{
      const id = e.target.getAttribute('data-id');
      const v = Math.max(1, parseInt(e.target.value||1,10));
      updateQty(id, v);
    });
  });
  document.querySelectorAll('.remove').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const id = btn.getAttribute('data-id');
      removeItem(id);
    });
  });
  document.getElementById('clearBtn').addEventListener('click', clearCart);
  updateBadge();
}

function updateQty(id, qty){
  let cart = JSON.parse(localStorage.getItem('df_cart')||'[]');
  cart = cart.map(it => it.id===id ? {...it, qty:qty} : it);
  localStorage.setItem('df_cart', JSON.stringify(cart));
  loadCart();
}

function removeItem(id){
  let cart = JSON.parse(localStorage.getItem('df_cart')||'[]');
  cart = cart.filter(it=>it.id!==id);
  localStorage.setItem('df_cart', JSON.stringify(cart));
  loadCart();
}

function clearCart(){
  if(!confirm('Clear entire cart?')) return;
  localStorage.removeItem('df_cart');
  loadCart();
}

function updateBadge(){
  const cart = JSON.parse(localStorage.getItem('df_cart')||'[]');
  const count = cart.reduce((s,i)=>s+(i.qty||1),0);
  // attempt to update badge element if exists
  const badge = document.getElementById('badge') || document.querySelector('#badge');
  if(badge) badge.textContent = count;
  // also the top checkout visibility
  document.getElementById('topCheckout').style.display = cart.length ? 'inline-block' : 'none';
}

loadCart();
</script>
</body>
</html>
